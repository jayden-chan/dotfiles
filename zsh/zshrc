# If you come from bash you might have to change your $PATH.
# export PATH=$HOME/bin:/usr/local/bin:$PATH

# Path to your oh-my-zsh installation.
export ZSH=$HOME/.oh-my-zsh
export EDITOR=nvim

# Set color scheme from wal
(cat ~/.cache/wal/sequences &)

ZSH_THEME="jayden-chan"
DEFAULT_USER="jayden"
prompt_context() {}
plugins=(git dotenv)

source $ZSH/oh-my-zsh.sh

# User configuration

stty stop undef
stty start undef

# Enable extended file globs
setopt extendedglob

# Git alias
alias gdf='cd $HOME/Documents/Git/dotfiles && git status'
alias gpf='cd $HOME/Documents/Git/programming-folder && git status'
alias gc='git commit -v -S'
alias gcop='git checkout production'
alias gpuu='git push -u origin $(git symbolic-ref --short HEAD)'

# Compilation
alias javc='javac -Xlint:all'
alias javca='javac -Xlint:all *.java'
alias javcl='rm *.class'
alias lcm='latexmk -pvc -pdf'
alias gr='./gradlew'
alias god='cd ~/Dev/Go/src/github.com/jayden-chan/'
alias mb='make build'
alias hh='git push heroku master && heroku logs --tail'

# dotfile editing
alias vimrc='vim $HOME/Documents/Git/dotfiles/vim/vimrc'
alias zshrc='vim $HOME/Documents/Git/dotfiles/zsh/zshrc'
alias dot='vim $HOME/Documents/Git/dotfiles/'

# Info
alias nfetch='neofetch --ascii_distro arch_old'

# Wifi
alias wifilist='nmcli dev wifi list'
alias wificonnect='nmcli con up'

# Exit
alias :q='exit'
alias :Q='exit'
alias :wq='exit'
alias :Wq='exit'

# Editor
alias vim='nvim'

# U S E R   E R R O R
alias cim='vim'
alias vom='vim'
alias vun='vim'
alias ivm='vim'
alias bim='vim'
alias dw='cd'
alias cs='cd'
alias clera='clear'
alias celar='clear'
alias clare='clear'
alias claer='clear'
alias ckear='clear'

# Other
alias please='sudo'
alias rs='cd && clear'
alias l='ls -A'
alias pdcli='node ~/Dev/Work/program-tools/packages/program-dev-cli/dist/index.js'
alias sshd='ssh jayden@jaydendesktop.ddns.net'
alias lpackages='comm -23 <(apt-mark showmanual | sort -u) <(gzip -dc /var/log/installer/initial-status.gz | sed -n '"'"'s/^Package: //p'"'"' | sort -u)'
alias comfy='vim $HOME/.vim/bundle/vim-comfy'
alias open='feh --auto-zoom --force-aliasing'
alias x='xset r rate 270 35'

function wallpaper () {
    if [ $HOST = "grace" ]; then
        nitrogen --set-zoom-fill --save --head=0 $1
        nitrogen --set-zoom-fill --save --head=1 $1
        nitrogen --set-zoom-fill --save --head=2 $1
    else
        nitrogen --set-zoom-fill --save $1
    fi
    wal -i $1 -n --backend $2
}

function wallsolid () {
    local p="$HOME/Pictures/Wallpapers/Single Screen/Solid.png"
    convert -size 1920x1080 xc:$1 $p

    if [ $HOST = "grace" ]; then
        nitrogen --set-zoom-fill --save --head=0 $p
        nitrogen --set-zoom-fill --save --head=1 $p
        nitrogen --set-zoom-fill --save --head=2 $p
    else
        nitrogen --set-zoom-fill $p
    fi

    echo "{\"special\":{\"background\":\"#3b3c3d\",\"foreground\":\"#d5d5d5\",\"cursor\":\"#d5d5d5\"},\"colors\":{\"color0\":\"#000000\",\"color1\":\"$2\",\"color2\":\"#ffffff\",\"color3\":\"#ffffb6\",\"color4\":\"$1\",\"color5\":\"$2\",\"color6\":\"$1\",\"color7\":\"$2\",\"color8\":\"#6c6c66\",\"color9\":\"$2\",\"color10\":\"#ffffff\",\"color11\":\"#ffffb6\",\"color12\":\"$1\",\"color13\":\"$2\",\"color14\":\"$1\",\"color15\":\"#fdfbee\"}}" > $HOME/Documents/Git/dotfiles/termite/solid-theme.json

    wal -f $HOME/Documents/Git/dotfiles/termite/solid-theme.json
}

function installfont () {
    sudo echo --- Installing font ---
    cp $1 $HOME/.local/share/fonts
    echo --- Refreshing font cache ---
    sudo fc-cache -fv
    echo --- Done ---
}

function lpac () {
    echo --- Native ---
    echo
    pacman -Qqettn
    echo
    echo --- AUR ---
    echo
    pacman -Qqettm
}

function uniqc () {
    echo "Unique commands executed: $(history \
        | rg '\d+\s+(.*)' --only-matching --replace='$1' \
        | sort \
        | uniq \
        | wc -l)"

    if [ "$#" = 1 ]; then
        echo "Top $1 commands:"
        echo "$(history \
            | rg '\d+\s+(.*)' --only-matching --replace='$1' \
            | sort \
            | uniq -c \
            | sort -nr \
            | head -$1 \
            | nl)"
    fi
}

function preview() {
    for file in $(ls -A); do
        if [[ -f $file ]]; then
            echo "File: $(tput bold)$file$(tput sgr0)"
            head -5 $file
            echo
        elif [[ -d $file ]]; then
            echo "Folder: $(tput bold)$file$(tput sgr0)"
            echo
        fi
    done

    echo "Number of files: $(ls -A | wc -l)"
    echo "Number of unique files: $(ls -A | sort | uniq -u | wc -l)"
}

function cargo_init() {
    if [ "$1" = "" ]; then
        echo "You must specify a project name"
    else
        cargo init $1
        cd $1
        touch README.md
        echo "# $1" > README.md

        if [ "$2" != "" ]; then
            echo "\n$2" >> README.md
        fi

        touch Makefile
        echo "build:\n\tcargo build\n\nrun:\n\tcargo run\n\n.PHONY: build run" > Makefile

        touch rustfmt.toml
        echo "max_width = 80" > rustfmt.toml

        touch LICENSE

        echo "Project creation finished, don't forget to add a license"
    fi
}

function pach () {
    cat /var/log/pacman.log | grep -iE 'installed|upgraded|removed' | tail -$1
}

function up_one_func {
    cd ..
    zle reset-prompt
}

function lsa_func {
    echo
    ls -A
    zle reset-prompt
}

function gst_func {
    echo
    git status
    zle reset-prompt
}

function mb_func {
    eval $JBUILD_COMMAND
    zle reset-prompt
}

function mr_func {
    eval $JRUN_COMMAND
    zle reset-prompt
}

zle -N up_one_widget up_one_func
bindkey '^E' up_one_widget

zle -N lsa_widget lsa_func
bindkey '^R' lsa_widget

zle -N gst_widget gst_func
bindkey '^G' gst_widget

zle -N mb_widget mb_func
bindkey '^B' mb_widget

zle -N mr_widget mr_func
bindkey '^N' mr_widget

# Opt out of .NET telemetry (yikes...)
export DOTNET_CLI_TELEMETRY_OPTOUT=1

# Export gradle path
export GOPATH=$HOME/Dev/Go
export PATH=$HOME/Dev/Go/bin:$PATH

# Make fzf respect .gitignore
export FZF_DEFAULT_COMMAND="rg --files"

# npm global packages config
export NPM_PATH="$HOME/.npm-global"
export PATH="$NPM_PATH/bin:$PATH"
export PATH=$HOME/.gem/ruby/2.6.0/bin:$PATH

# Add cargo binaries
export PATH="$HOME/.cargo/bin:$PATH"

unset MANPATH
export MANPATH="$NPM_PATH/share/man:$(manpath)"

# Ensure GPG sign prompt shows on correct screen
export GPG_TTY=$(tty)
gpg-connect-agent updatestartuptty /bye >/dev/null

[[ $TMUX = "" ]] && export TERM="xterm-256color"
